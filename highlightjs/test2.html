<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Highlight JS test</title>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/darkula.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
    <script src="scripts/angular.js"></script>
    <script src="scripts/angular-sanitize.js"></script>
</head>
<body ng-app="myApp">
<h1>Code highlight sample</h1>

<div ng-controller="myCtrl" style="width: 600px;">
    <div>
        <textarea ng-model="codeblock" rows="10" cols="60"></textarea>
    </div>
    <div ng-bind-html="codeblock" code-highlight-directive>

    </div>

    <h2>Getting data from REST API</h2>
    <div ng-bind-html="codetoformat" code-highlight-directive>

    </div>
</div>


<script>
    var app = angular.module('myApp', ['ngSanitize']);


    app.factory("codeFactory", ['$http', function ($http) {
        return {
            get: function (url) {
                return $http.get(url).then(function (resp) {
                    return resp.data; // success callback returns this
                });
            }
        }

    }]);

    app.controller("myCtrl", ['$scope', 'codeFactory', function ($scope, codeFactory) {
        codeFactory.get('data.json').then(function (data) {
            $scope.codetoformat = data["CodeBlock"];
        })
    }]);


    app.directive('codeHighlightDirective', function () {
        return {
            link: function ($scope, $el, $attrs) {
                $scope.$watch(
                        function () {
                            return $el.find('code')[0];
                        },
                        function (oldvalue, newvalue) {
                            hljs.highlightBlock($el.find('code')[0]);
                        }
                )
            }
        }
    });


</script>

</body>
</html>